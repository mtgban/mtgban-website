<!DOCTYPE html>
<html>
<head>
    <link href='https://fonts.googleapis.com/css?family=Rosario:400' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="/css/main.css?hash={{.Hash}}">
    <link href="//cdn.jsdelivr.net/npm/keyrune@latest/css/keyrune.css" rel="stylesheet" type="text/css" />

    <link rel="search" type="application/opensearchdescription+xml" title="MTGBAN Price Search" href="/api/opensearch.xml" />

    {{if .Embed.OEmbedURL}}
        <link rel="alternate" type="application/json+oembed" href="{{.Embed.OEmbedURL}}" title="MTGBAN Price Search"/>
        <meta property="og:site_name" content="MTGBAN Price Search" />
        <meta property="og:type" content="product" />
        <meta property="og:title" content="{{.Embed.Title}}" />
        <meta property="og:description" content="{{.Embed.Contents}}" />
        <meta property="og:url" content="{{.Embed.PageURL}}" />
        <meta property="og:image" content="{{.Embed.ImageURL}}" />

        <meta name="twitter:creator" content="@MTG_BAN" />
        <meta name="twitter:site" content="@MTG_BAN" />
        <meta name="twitter:domain" content="https://mtgban.com/" />
        <meta name="twitter:card" content="product" />
        <meta name="twitter:image" content="{{.Embed.ImageCropURL}}" />
        <meta name="twitter:title" content="{{.Embed.Title}}" />
        <meta name="twitter:description" content="{{.Embed.Description}}" />
        <meta name="twitter:label1" content="TCGplayer Market Price" />
        <meta name="twitter:data1" content="{{if .Embed.RetailPrice}}{{printf "$ %.2f" .Embed.RetailPrice}}{{else}}N/A{{end}}" />
        <meta name="twitter:label2" content="Card Kingdom Buylist" />
        <meta name="twitter:data2" content="{{if .Embed.BuylistPrice}}{{printf "$ %.2f" .Embed.BuylistPrice}}{{else}}N/A{{end}}" />
    {{end}}

    <title>
        {{.Title}}{{if .CleanSearchQuery}}: {{.CleanSearchQuery}}{{end}}
    </title>
        <script type="text/javascript" src="/js/autocomplete.js?hash={{.Hash}}"></script>
        <script type="text/javascript" src="/js/fetchnames.js?hash={{.Hash}}"></script>
    {{if .ChartID}}
        <script type="text/javascript"
                 src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.bundle.js"
           integrity="sha512-zO8oeHCxetPn1Hd9PdDleg5Tw1bAaP0YmNvPY8CwcRyUk7d7/+nyElmFrB6f7vg4f7Fv4sui1mcep8RIEShczg=="
         crossorigin="anonymous"></script>
        <script type="text/javascript" src="/js/chartopts.js?hash={{.Hash}}"></script>
    {{end}}

    <link rel="apple-touch-icon" sizes="120x120" href="/img/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon/favicon-16x16.png">
    <link rel="manifest" href="/img/favicon/site.webmanifest">
    <link rel="mask-icon" href="/img/favicon/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href="/img/favicon/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="/img/favicon/browserconfig.xml">
    <meta name="theme-color" content="#ff0000">
</head>

<body class="light-theme">
<script type="text/javascript" src="/js/filtering.js?hash={{.Hash}}"></script>
<nav>
    <ul>
        <li><a href="https://www.patreon.com/mtgban"><img src="/img/misc/patreon.png" width=48></a></li>
        <li {{if .PatreonLogin}}style="display:none"{{end}}><a href="/discord"><img src="/img/misc/discord.png" width=48></a></li>
        {{range .Nav}}
            <li>
                <a {{if .Active}}class="{{.Class}}"{{end}} href="{{.Link}}">
                    <span>{{.Short}} {{.Name}}</span>
                </a>
            </li>
        {{end}}
        <li>
            <label class="switch">
                <div>
                    <input id="theme-toggle" type="checkbox"/>
                    <span class="slider"></span>
                </div>
                <script type="text/javascript" src="/js/nightmode.js?hash={{.Hash}}"></script>
            </label>
        </li>
    </ul>
</nav>

<div class="mainbody">
    {{if ne .ErrorMessage ""}}
        <h1>{{.ErrorMessage}}</h1>
    {{else if eq .Title "Options"}}
        <script type="text/javascript" src="/js/cookies.js?hash={{.Hash}}"></script>
        <br>

        <script type="text/javascript">
            window.onload = function(e) {
                loadForm("SearchSellersList", "sellers");
                loadForm("SearchVendorsList", "vendors");
                loadForm("SearchMiscOpts", "miscOpts");
                loadRadio("SearchDefaultSort", "defaultSort");
                loadRadio("SearchListingPriority", "listingPriority");
                loadDropdown("SearchSellersPriority", "sellersPriority");
                loadDropdown("SearchVendorsPriority", "vendorsPriority");
            }
        </script>

        <div class="indent">
            <h2>Stores</h2>
            Select which sellers or vendors you <b>don't</b> want to display in your searches.
            <br>

            <a class="btn warning" onclick="javascript:clearForm('sellers'); clearForm('vendors');"><b>CLEAR</b></a>
            <a class="btn success" onclick="javascript:selectAll('sellers');"><b>Select ALL Sellers</b></a>
            <a class="btn success" onclick="javascript:selectAll('vendors');"><b>Select ALL Vendors</b></a>
            <a class="btn success" onclick="javascript:saveForm('SearchSellersList', 'sellers'); saveForm('SearchVendorsList', 'vendors'); window.location.href = '/search'"><b>SAVE</b></a>
        </div>

        <br>
        <div class="indent row">
            <div class="column" id="sellers">
                <h3>Retail</h3>
                {{range $i, $key := .SellerKeys}}
                    <input type="checkbox" id="s{{$key}}" name="{{$key}}">
                    <label for="s{{$key}}">
                        {{scraper_name $key}}
                        {{if (contains $key "Sealed")}}
                            <i>(Sealed)</i>
                        {{end}}
                    </label>
                    <br>
                {{end}}
            </div>
            <div class="column" id="vendors">
                <h3>Buylist</h3>
                {{range $i, $key := .VendorKeys}}
                    <input type="checkbox" id="v{{$key}}" name="{{$key}}">
                    <label for="v{{$key}}">
                        {{scraper_name $key}}
                        {{if (contains $key "Sealed")}}
                            <i>(Sealed)</i>
                        {{end}}
                    </label>
                    <br>
                {{end}}
            </div>
        </div>

        <br>
        <div class="indent">
            <h2>Result sorting</h2>
            Select how card results should be sorted by.
            <br>

            <a class="btn success" onclick="javascript:saveRadio('SearchDefaultSort', 'defaultSort'); window.location.href = '/search'"><b>SAVE</b></a>
        </div>

        <br>
        <div class="indent row">
            <div class="column" id="defaultSort">
                <input type="radio" id="chrono" name="sort" value="chrono" checked>
                <label for="chrono">By chronological order</label>
                <br>
                <input type="radio" id="hybrid" name="sort" value="hybrid" checked>
                <label for="hybrid">By alphabetical order, grouping sets by chronological order</label>
                <br>
                <input type="radio" id="alpha" name="sort" value="alpha">
                <label for="alpha">By alphabetical order</label>
                <br>
                <input type="radio" id="number" name="sort" value="#">
                <label for="number">By collector number</label>
                <br>
                <input type="radio" id="retail" name="sort" value="retail">
                <label for="retail">By best retail price (off TCGplayer)</label>
                <br>
                <input type="radio" id="buylist" name="sort" value="buylist">
                <label for="buylist">By best buylist price (off Card Kingdom)</label>
                <br>
            </div>
        </div>

        <br>
        <div class="indent">
            <h2>Preferred retail/buylist sort option</h2>
            Select which retail and buylist stores should sort  by.
            <br>

            <a class="btn success" onclick="javascript:saveDropdown('SearchSellersPriority', 'sellersPriority'); saveDropdown('SearchVendorsPriority', 'vendorsPriority'); window.location.href = '/search'"><b>SAVE</b></a>
        </div>

        <br>
        <div class="indent row">
            <div class="column" id="sortPriority">
                <label for="sellersPriority">Retail priority</label>
                <select id="sellersPriority" class="select-css">
                    <option selected disabled hidden>&nbsp;&nbsp;&nbsp;Pick a store</option>
                    <option value="">&nbsp;&nbsp;&nbsp;Reset to Default</option>
                    {{range $i, $key := .SellerKeys}}
                        <option value="{{$key}}">&nbsp;&nbsp;&nbsp;{{scraper_name $key}}</option>
                    {{end}}
                </select>

                <label for="vendorsPriority">Buylist priority</label>
                <select id="vendorsPriority" class="select-css">
                    <option selected disabled hidden>&nbsp;&nbsp;&nbsp;Pick a store</option>
                    <option value="">&nbsp;&nbsp;&nbsp;Reset to Default</option>
                    {{range $i, $key := .VendorKeys}}
                        <option value="{{$key}}">&nbsp;&nbsp;&nbsp;{{scraper_name $key}}</option>
                    {{end}}
                </select>
            </div>
        </div>

        <br>
        <div class="indent">
            <h2>Listing priority</h2>
            Select how price results should be sorted by.
            <br>

            <a class="btn success" onclick="javascript:saveRadio('SearchListingPriority', 'listingPriority'); window.location.href = '/search'"><b>SAVE</b></a>
        </div>

        <br>
        <div class="indent row">
            <div class="column" id="listingPriority">
                <input type="radio" id="stores" name="priority" value="stores" checked>
                <label for="stores">Alphabetical, by store name</label>
                <br>
                <input type="radio" id="prices" name="priority" value="prices">
                <label for="prices">Asc for Retail, Desc for Buylist, by prices</label>
                <br>
                <input type="radio" id="credit" name="priority" value="credit">
                <label for="credit">Asc for Retail, Desc for Buylist, by credit prices</label>
                <br>
                <input type="radio" id="market" name="priority" value="market">
                <label for="credit">Asc for Retail, Desc for Buylist, by credit market prices</label>
                <br>
            </div>
        </div>

        <br>
        <div class="indent">
            <h2>Other preferences</h2>
            Miscellaneous life hacks for Search.
            <br>

            <a class="btn warning" onclick="javascript:clearForm('miscOpts');"><b>CLEAR</b></a>
            <a class="btn success" onclick="javascript:saveForm('SearchMiscOpts', 'miscOpts'); window.location.href = '/search'"><b>SAVE</b></a>
        </div>

        <br>
        <div class="indent row">
            <div class="column" id="miscOpts">
                <input type="checkbox" id="noSussy" name="noSussy">
                <label for="noSussy">Skip invalid TCGplayer Direct prices (2x Market, or no Market)</label>
                <br>
                <input type="checkbox" id="hidePrelPack" name="hidePrelPack">
                <label for="hidePrelPack">Hide classic Promotional entries (<i>promopack, prerelease, etc</i>)</label>
                <br>
                <input type="checkbox" id="hidePromos" name="hidePromos">
                <label for="hidePromos">Hide ALL Promotional entries (<i>judge, buyabox, bundle, some sets, etc</i>)</label>
                <br>
                <input type="checkbox" id="preferFlavor" name="preferFlavor">
                <label for="preferFlavor">Prefer <i>flavor name</i> when available (global setting)</label>
                <br>
                <input type="checkbox" id="hideBLconds" name="hideBLconds">
                <label for="hideBLconds">Hide non-NM Buylist entries</label>
                <br>
                <input type="checkbox" id="skipEmpty" name="skipEmpty">
                <label for="skipEmpty">Skip results with no prices</label>
                <br>
                <input type="checkbox" id="noSyp" name="noSyp">
                <label for="noSyp">Don't show the SYP indication (‚Ä†)</label>
                <br>
                <input type="checkbox" id="noUpsell" name="noUpsell">
                <label for="noUpsell">Hide the upsell reminder to download CSVs</label>
                <br>
            </div>
        </div>

    {{else}}
        <h1>
            {{if .ChartID}}
                {{$card := (index $.Metadata .ChartID)}}
                <h1 lang="{{$card.LangTag}}" class=indent style="width: fit-content">
                    {{$card.Name}}
                    <hr>
                    {{if not $.IsSealed}}
                        <h3 lang="en" class=indent>{{$card.Variant}}</h4>
                    {{end}}
                    <h5 lang="en" class=indent>{{$card.Title}}</h5>
                </h1>
            {{else}}
                Welcome to {{$.Title}}

                {{if .TotalUnique}}
                    -
                    <small><small><small>
                        {{.TotalUnique}}
                        {{if .TotalCards}}
                            / {{.TotalCards}}
                        {{end}}
                        {{if .IsSealed}}product{{else}}card{{end}}{{if gt (len .AllKeys) 1}}s{{end}} found
                        {{if gt .TotalUnique (len .AllKeys)}}
                            ({{len .AllKeys}} shown)
                        {{end}}
                    </small></small></small>
                {{end}}
            {{end}}
        </h1>

        {{if .IsSealed}}
            <img id="hoverImage" class="hoverImage" src=""/>
            <script type="text/javascript" src="/js/followmouse.js?hash={{.Hash}}"></script>
        {{end}}

        <div class="indent sticky" style="top: 48px; background-color: var(--background); float:left">
            <form class="search autocomplete" action="" autocomplete="off" spellcheck="false" id="searchform">
                <label style="clear: both; float: left; width: 115%" for="searchbox">
                    {{if not .SearchQuery}}
                        Search for a {{if .IsSealed}}product{{else}}card{{end}}, or... <a class="btn info" href="/random{{if .IsSealed}}sealed{{end}}">surprise me</a>
                    {{else}}
                        Sort
                        {{if .NoSort}}
                            from syntax
                        {{else}}
                            <a class="btn info" href="?q={{.SearchQuery}}&sort=" title="Sort by chronological order">
                                {{if or (eq .SearchSort "chrono") (not .SearchSort)}}<b>{{end}}chrono{{if or (eq .SearchSort "chrono") (not .SearchSort)}}</b>{{end}}
                            </a>
                            {{if or (eq .SearchSort "chrono") (not .SearchSort)}}
                                <a href="?q={{.SearchQuery}}&sort=&reverse={{not .ReverseMode}}" title="Sort by reverse chronological order">üîÑ</a>
                            {{end}}

                            {{$isAlphaSorted := or (eq .SearchSort "alpha") (eq .SearchSort "hybrid")}}
                            <a class="btn info" href="?q={{.SearchQuery}}&sort=alpha" title="Sort by alphabetical order{{if eq .SearchSort "hybrid"}} (keeping sets grouped){{end}}">
                                {{if $isAlphaSorted}}<b>{{end}}alpha{{if $isAlphaSorted}}</b>{{end}}
                            </a>
                            {{if $isAlphaSorted}}
                                <a href="?q={{.SearchQuery}}&sort=alpha&reverse={{not .ReverseMode}}" title="Sort by reverse alphabetical order{{if eq .SearchSort "hybrid"}} (keeping sets grouped){{end}}">üîÑ</a>
                            {{end}}

                            <a class="btn info" href="?q={{.SearchQuery}}&sort=number" title="Sort by collector number">
                                {{if eq .SearchSort "number"}}<b>{{end}}#{{if eq .SearchSort "number"}}</b>{{end}}
                            </a>
                            {{if eq .SearchSort "number"}}
                                <a href="?q={{.SearchQuery}}&sort=number&reverse={{not .ReverseMode}}" title="Sort by collector number">üîÑ</a>
                            {{end}}

                            <a class="btn info" href="?q={{.SearchQuery}}&sort=retail" title="Sort by best retail price (off TCGplayer)">
                                {{if eq .SearchSort "retail"}}<b>{{end}}retail{{if eq .SearchSort "retail"}}</b>{{end}}
                            </a>
                            {{if eq .SearchSort "retail"}}
                                <a href="?q={{.SearchQuery}}&sort=retail&reverse={{not .ReverseMode}}" title="Sort by lowest retail price (off TCGplayer)">üîÑ</a>
                            {{end}}

                            <a class="btn info" href="?q={{.SearchQuery}}&sort=buylist" title="Sort by best buylits price (off Card Kingdom)">
                                {{if eq .SearchSort "buylist"}}<b>{{end}}buylist{{if eq .SearchSort "buylist"}}</b>{{end}}
                            </a>
                            {{if eq .SearchSort "buylist"}}
                                <a href="?q={{.SearchQuery}}&sort=buylist&reverse={{not .ReverseMode}}" title="Sort by lowest buylits price (off Card Kingdom)">üîÑ</a>
                            {{end}}
                        {{end}}
                        <span class=emoji>
                            <a class="btn info" title="...more surpises" href="/random{{if .IsSealed}}sealed{{end}}">üé∞</a>
                        </span>
                    {{end}}
                    <span class=emoji>
                        <a href="?page=options" title="Search settings">‚öôÔ∏è</a>
                    </span>
                </label>
                <input id="searchbox" class="w3-input w3-border w3-round-small search-input" onFocus="this.setSelectionRange(0, this.value.length)" type="text" name="q" placeholder="Enter a {{if .IsSealed}}product{{else}}card{{end}} name" value="{{.SearchQuery}}" maxlength="1000" autofocus autocapitalize="none">
            </form>

            <script type="text/javascript">
                autocomplete(document.getElementById("searchform"), document.getElementById("searchbox"), {{if .IsSealed}}"true"{{else}}"false"{{end}});
            </script>

        {{if and (eq .SearchQuery "") (not .IsSealed)}}
            {{template "syntax" .}}
        {{else if and (eq .SearchQuery "") (.IsSealed)}}
            <p style="max-width: 70%">
                Make sure to read the <a class="btn normal" href="#faq">F.A.Q.</a>
                <br>
                Jump to
                {{range $key := .EditionSort}}
                    <a class="btn normal" href="#{{.}}">{{.}}</a>
                {{end}}
                <br>
                Filter by <input type="text" style="margin-left: 8px;" id="filterInput" onkeyup="filterPageContent()" placeholder="Edition...">
            </p>

            {{range $key := .EditionSort}}
                <div class="sticky" style="top: 48px; background-color: var(--background);">
                    <span class="anchor" id="{{.}}"></span>
                    <h3 class="storename">{{.}}</a></h3>
                    <hr width=15%>
                </div>

                <div class="indent" style="max-width: 85%; padding-top:10px">
                    {{$editionList := index $.EditionList $key }}
                    {{range $editionList}}
                        <nobr>
                            <i class="ss ss-{{.Keyrune}} ss-2x ss-fw"></i>
                            <a class="btn normal" href="/sealed?q=s:{{.Code}}">
                                {{.Name}}
                            </a>
                        </nobr>
                    {{end}}
                </div>
                <br>
            {{end}}

            <div style="max-width: 85%; padding-top:10px">
                <span class="anchor" id="faq"></span>
                <h3>F.A.Q.</h3>
                <br>
                <ul class="indent">
                    <li>
                        <h4>Understanding EV and SIM at BAN</h4>
                        <ul class="indent">
                            At BAN, we aim to empower our users with data-driven insight into the potential value of their sealed MTG products through two distinct but complementary methods: Expected Value (EV) and Simulated Box Openings (SIM).<br>
                            For any product with a static decklist, the card values are just summed up and provided as is, and there is no difference between the two methods, while for product with randomness associated with it (ie. booster packs and certain decks) there can be profound differences between predicted value and typical openings, especially at low sample sizes. Thus, we take both approaches to help the user decide the spread and likely value of opening moderate to large amount of product vs. selling it outright.
                        </ul>
                    </li>
                    <li>
                        <h4>How is EV calculated?</h4>
                        <ul class="indent">
                            EV calculates a product's average value by analyzing the distribution of cards on print sheets, using each card's drop rate and market value. This approach offers a theoretical perspective on what a product might be worth, providing a foundational understanding of its potential value. In other words the final value of the box is linearly dependent on the drop rate (or probability) for each card to appear in any given booster slot.
                        </ul>
                    </li>
                    <li>
                        <h4>How is SIM calculated?</h4>
                        <ul class="indent">
                            SIM, in contrast, brings the experience of opening booster packs and boxes closer to reality. We take the known probabilities of each card appearing in a product and use a random number generator to generate a random box from this information. This is repeated thousands of times leading to a large data set in which we can get some useful insights that the EV number alone cannot show us such as the Median and Standard Deviation.<br>
Sims are not required for pre-constructed decks and other products where the same cards appear every time.
                        </ul>
                    </li>
                    <li>
                        <h4>What are the median and standard deviation representing?</h4>
                        <ul class="indent">
                            The Median is the middle value of a data set. For example, if we simulate 5000 boxes and organise the box values from smallest to largest, the Median value would be the value of the 2500th box. The metric in itself does not say much, but comparing the Median to the EV is useful. If the Median is a lot lower than the EV then we can assume the EV is being skewed higher by some top-heavy chase cards where a lot of the value in a product may be.<br>

                            The Standard Deviation measures the spread of values in a data set. The higher the Standard Deviation, the more variance you will experience opening a product. For example, if the EV of a box is $100 and all other boxes are either $99 or $101, we have Standard Deviation of 1. All values are extremely clustered and you can expect your opening to be extremely consistent and low risk.<br>

                            If the EV is $100 and the Standard Deviation is $40 then expect some swings. The more boxes you open, the more likely you are to get closer to the true EV of $100 a box but, depending on the product, the number of boxes required for that to be likely may vary.
                       </ul>
                    </li>
                    <li>
                        <h4>Which is the one I should follow?</h4>
                        <ul class="indent">
                            Our objective at BAN is to furnish our members with detailed and actionable insights into their collectibles. By merging the theoretical calculations of EV with the practical applications of SIM, we ensure a comprehensive analysis that supports informed decision-making. As always the "best" method is wildly dependant on individual business and use case.<br>
                            Large openers may want to focus purely on EV, safe in the knowledge that over months and years they are likely to be close to EV. Smaller openers may decide to forgo high variance products if a bad showing will put them in a tough financial situation, even if a product is tehnically +EV to open.
                        </ul>
                    </li>
                    <li>
                        <h4>Why are some products tagged with high IQR?</h4>
                        <ul class="indent">
                            Simplifying a bit, IQR is a statistical method to find how many outliers are present in the data. This value basically tells you how your data is distributed and how many prices deviate from the typical range (and by how much). A high IQR indicates thate there are a lot of cards with very high prices, meaning the chances of hitting this cards is lower than the norm, but when performing box simulations, even in high number, they may skew the final prospect value.
                            In order to warn BAN users that something may be off, either due to an unlucky simulation, or due to plain bad data, we tag those products accordingly, and exclude them when appropriate. The computation is proportional to the market condition, meaning it accounts for both older sealed product with cards in the thousands of dollars, as well as recent product with a small number of chase cards (as reminder, serialized cards are not used in any of our computations).
                            Always make sure to understand the data well and perform your own research, before making any financial decision, and doubly more so for any product tagged with high IQR.
                        </ul>
                    </li>
                    <li>
                        <h4>How do you emulate booster openings?</h4>
                        <ul class="indent">
                            We use data from multiple projects, in paritcular we derive the collation information from the <a href="https://www.lethe.xyz/mtg/collation/">Lethe project</a>, the distribution of cards in the boosters from <a href="https://github.com/taw/magic-search-engine">mtg.wft search engine</a>, the contents description from <a href="https://github.com/mtgjson/mtg-sealed-content">MTGJSON</a>, and the decklists come from <a href="https://github.com/taw/magic-preconstructed-decks">this repository</a>. Please refer to each project website to know more how estimations works (and to help out with data ingestion).<br>
                            If you are interested in the BAN algorithm, you can check <a href="https://github.com/mtgban/go-mtgban/blob/master/sealedev/api.go">this file</a> for the estimation model, and <a href="https://github.com/mtgban/go-mtgban/blob/master/sealedev/sealedev.go">this file</a> for the actual computation.
                        </ul>
                    </li>
                    <li>
                        <h4>Can you describe the data sources available?</h4>
                        <ul class="indent">
                            There are three EV-dependent data sources: <i>TCG Low</i>, which reflects the lowest possible value on TCG (excluding shipping), <i>TCG Direct</i>, which represents the Direct price <u>minus fees</u> that the cards could be sold at, and <i>CK buylist</i>, which shows how much a given set of cards could be sold to the vendor. Note that TCG Direct prices could be sometimes skewed due to ridiculous prices being set by sellers "parking" their cards - we try to work around this by capping the maximum value to twice as much as TCG Low when we're able to detect such an offset. <br>
                            The other prices shown under <i>Purchase from</i> and <i>Sell to</i> represent the prices of the sealed products as available from different stores.
                        </ul>
                    </li>
                    <li>
                        <h4>Why is this set missing?</h4>
                        <ul class="indent">
                           Given there is a three way dependency on the source data, it might be that the information for the given set or product simply hasn't been filled and has not propagated to us yet. Retry in a few days or, if you're able to code, try contributing to one of the open source projects mentioned above.
                        </ul>
                    </li>
                    <li>
                        <h4>What's up with these odd prices for this just released set?</h4>
                        <ul class="indent">
                           Our prices reflect the price of the actual printing of the card, they do not reflect the value of the card before the reprint. As such it takes a few days for all the listings to be filled in and for prices to propagate to the calculator -- in particular, in case of Direct prices might look a bit off until the whole TCG Direct inventory appears, and in the meantime we'll do our best estimates using the market price. Also keep in mind that in the early days, the expected values will reflect preorder prices, which are almost always higher than normal.
                        </ul>
                    </li>
                    <li>
                        <h4>How is Set Value computed and why does it differs from buylist?</h4>
                        <ul class="indent">
                            The set value is the daily sum of every single printing of every single card within the same set, for nonfoil and foil printings when available. It may be considered as indicating the value of the entire collection in NM condition. As such the set value is not affected by any element of randomness, which is instead taken into account by the listed entry.
                        </ul>
                    </li>
                    <li>
                        <h4>What are the custom buttons next to product titles for?</h4>
                        <ul class="indent">
                            These two buttons lead to different search options:<br>
                            * the üéÅ (when available) will similuate opening a pack using the information available. Every run is fully randomized and unpredictable;<br>
                            * the üîç will unpack a product and list all its possible contents. This means that a booster box will only list a single booster pack, while a booster pack will display all possible picks.<br>
                            * the <img width=14 src=img/misc/decklist.png> (when available) will let you download a CSV of the decklist, TCGplayer-formatted, ready for uplaod.<br>
                            In both cases, once in the search page, you can add search terms normally to filter for color, rarities, and names using the common search syntax.<br>
                            Note that depending on the content type, the search result might show you at most one copy per card or list the same card multiple times: this to show accurate and easy to import results for decklists and box sets, while displaying compact results for other sealed types.<br>
                        </ul>
                    </li>
                    <li>
                        <h4>This product has multiple copies of the same card, but I see only one, what gives?</h4>
                        <ul class="indent">
                            In order to avoid polluting the results with multiple instances of the same information, duplicated copies of the same cards are hidden in the search results. Even though the search only lists one card, the presented EV and SIM calcs do take into account the possibility of opening multiple copies of the same card.
                        </ul>
                    </li>
                    <li>
                        <h4>Is there a minimum or maxumum value for a card to be considered?</h4>
                        <ul class="indent">
                           Yes. Initially we considered every single price found and added it up, but we found out that counting up "worthless cards" and "extremely expensive cards" skew the results even on repeated runs. So we're now excluding all bulk (sub $0.30) and all serialized cards, since the odds of opening are low, but impact the result too optimistically. This is true for both EV and SIM, and in the latter case the multiple runs should take care of the variance for computation for all other cards.
                        </ul>
                    </li>
                </ul>

                <br>
                <h3>Disclaimer</h3>
                <br>
                <p>
                    Information in this EV calculation is not guaranteed and should not be used solely to make financial decisions.
                </p>
            </div>

        {{else}}
            <script type="text/javascript" src="/js/copy2clip.js?hash={{.Hash}}"></script>
            <script type="text/javascript" src="/js/updatesearch.js?hash={{.Hash}}"></script>

            <script type="text/javascript">
                function updateSidebar(src, printings, products) {
                    {{if not .IsSealed}}
                        document.getElementById('cardImage').src=src;
                    {{else}}
                        document.getElementById('hoverImage').src=src;
                    {{end}}
                    document.getElementById('printings').innerHTML = printings;

                    let productDiv = document.getElementById('products');
                    if (productDiv) {
                        if (products === "") {
                            products = "n/a"
                        }
                        productDiv.innerHTML = products;
                    }
                }

                function getLastSold(uuid) {
                    fetch('/api/tcgplayer/lastsold/' + uuid)
                    .then((response) => response.json())
                    .then((data) => {
                        document.getElementById('lastsolda' + uuid).setAttribute("href", "javascript:void(0)");
                        let table = document.getElementById(uuid);
                        table.style.display = "";
                        document.getElementById('lastsalesth').style.display = "";

                        if (data.length == 0) {
                            table.innerHTML = ' \
                                <tr style="background-color:rgba(0, 0, 0, 0);"> \
                                    <td colspan="4"> <center> N/A </center> </td> \
                                </tr>';
                        }
                        data.forEach(element => {
                            let newRow = table.insertRow()

                            let orderCell = newRow.insertCell();
                            let formatDate = new Date(element.orderDate);
                            let timestamp = formatDate.toISOString().slice(0, 10) + " " + formatDate.toLocaleTimeString();
                            let anchor = document.createElement("a")
                            anchor.classList.add("btn", "default");
                            anchor.innerText = timestamp;
                            orderCell.appendChild(anchor);

                            let condCell = newRow.insertCell();
                            condCell.style.textAlign = "center";
                            let condText = document.createTextNode(element.condition.replace(/[^A-Z]/g, '').replace('LP', 'SP'));
                            condCell.appendChild(condText);

                            if (element.language !== "English") {
                                let langCell = newRow.insertCell();
                                langCell.style.textAlign = "center";
                                let langText = document.createTextNode(element.language);
                                langCell.appendChild(langText);
                            }

                            let priceCell = newRow.insertCell();
                            priceCell.style.textAlign = "center";
                            let priceText = document.createTextNode("$ " + (element.purchasePrice + (element.shippingPrice / element.quantity)).toFixed(2));
                            priceCell.appendChild(priceText);

                            let qtyCell = newRow.insertCell();
                            qtyCell.style.textAlign = "center";
                            let qtyText = document.createTextNode(element.quantity + "x");
                            qtyCell.appendChild(qtyText);
                        });
                    });
                }
            </script>

            {{$emptyImg := "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"}}
            <div>
                <table style="float: left; background-color: var(--background); width: 360px">
                    {{if .IsSealed}}
                        <tr class="no-hover" style="background-color: var(--background)">
                            <td>
                                <div id="printings" style="text-align: center; max-width: 360px; display: block;"></div>
                            </td>
                        </tr>
                        {{if .HasAvailable}}
                            <tr>
                                <td>
                                    <center>
                                        <h4>Available in</h4>
                                    </center>
                                    <div id="products" style="text-align: center; max-width: 360px; display: block;"></div>
                                </td>
                            </tr>
                        {{end}}
                    {{else}}
                        <tr class="no-hover" style="background-color: var(--background)" >
                            <td>
                                <img id="cardImage" src="" width="360" height="502" onclick="var input = document.getElementById('searchbox'); input.focus(); input.setSelectionRange(0, input.value.length); return false;"/>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div id="printings" style="text-align: center; max-width: 360px; display: block;"></div>
                                {{if .CanShowAll}}
                                    <center>
                                        <a class="btn info" href="search?q={{.CleanSearchQuery}}">Show all versions</a>
                                    </center>
                                {{end}}
                            </td>
                        </tr>
                        {{if .HasAvailable}}
                            <tr>
                                <td>
                                    <center>
                                        <h4>Available in</h4>
                                    </center>
                                    <div id="products" style="text-align: center; max-width: 360px; display: block;"></div>
                                </td>
                            </tr>
                        {{end}}
                        {{if not (eq .Alternative "")}}
                            <tr>
                                <td>
                                    <center>
                                        <a class="btn warning" href="/search?chart={{.Alternative}}">Switch Foil/Non-Foil</a>
                                    </center>
                                </td>
                            </tr>
                        {{end}}
                        {{if not (eq .AltEtchedId "")}}
                            <tr>
                                <td>
                                    <center>
                                        <a class="btn warning" href="/search?chart={{.AltEtchedId}}">Switch Etched/Non-Etched</a>
                                    </center>
                                </td>
                            </tr>
                        {{end}}
                        {{if not (eq .StocksURL "")}}
                            <tr>
                                <td>
                                    <center>
                                        <a class="btn success" href="{{.StocksURL}}" target="_blank">Check MTGStocks charts</a>
                                    </center>
                                </td>
                            </tr>
                        {{end}}
                    {{end}}
                    {{if .CanDownloadCSV}}
                        <tr>
                            <td>
                                <center>
                                    Download prices as CSV<br>
                                    <a class="btn success" href="/api/search/retail{{if .IsSealed}}/sealed{{end}}/{{.SearchQuery}}.csv" download="mtgban_retail_prices{{if .IsSealed}}_sealed{{end}}.csv">Retail</a>
                                    <a class="btn warning" href="/api/search/buylist{{if .IsSealed}}/sealed{{end}}/{{.SearchQuery}}.csv" download="mtgban_buylist_prices{{if .IsSealed}}_sealed{{end}}.csv">Buylist</a>
                                    <br>
                                    Get card list<br>
                                    <a class="btn normal" href="/api/search/list{{if .IsSealed}}/sealed{{end}}/{{.SearchQuery}}.csv" download="mtgban_decklist{{if .IsSealed}}_sealed{{end}}.csv">Download</a>
                                </center>
                            </td>
                        </tr>
                        {{if not .IsSealed}}
                            <tr>
                                <td>
                                    <center>
                                        Load search in Uploader<br>
                                        <form action="/upload" method="post">
                                            <input id="mode" type="hidden" name="mode" value="false"/>
                                            {{range .CardHashes}}
                                                <input type="hidden" name="hashes" value="{{.}}"/>
                                            {{end}}
                                            <a class="btn success" style="text-align: center;" onclick='document.getElementById("mode").value=false; this.parentNode.submit(); return false;'>Retail</a>
                                            <a class="btn warning" style="text-align: center;" onclick='document.getElementById("mode").value=true; this.parentNode.submit(); return false;'>Buylist</a>
                                            <noscript>
                                                <input type="submit" value="Check Uploader!" />
                                            </noscript>
                                        </form>
                                    </center>
                                </td>
                            </tr>
                        {{end}}
                    {{else if $.ShowUpsell}}
                        <tr>
                            <td>
                                <center>
                                    <i>
                                        Increase your tier to be able to download any search results as CSVs{{if not .IsSealed}} or to transfer them to the Upload optimizer!{{end}}
                                    </i>
                                </center>
                            </td>
                        </tr>
                    {{end}}
                    <tr>
                        <td style="background-color: var(--background);">
                            {{if .HasReserved}}
                                <h4>
                                    {{if .ChartID}}<center>{{else}}* ={{end}}
                                    Part of the <a href="https://mtg.wiki/page/Reserved_List">Reserved List</a>
                                    {{if .ChartID}}</center>{{end}}
                                </h4>
                            {{end}}
                            {{if .HasStocks}}
                                <h4>
                                    {{if .ChartID}}<center>{{else}}‚Ä¢ ={{end}}
                                    On <a href="https://mtgstocks.com/interests">MTGStocks Interests</a> page
                                    {{if .ChartID}}</center>{{end}}
                                </h4>
                            {{end}}
                            {{if .HasSypList}}
                                <h4>
                                    {{if .ChartID}}<center>{{else}}‚Ä† ={{end}}
                                    Found in the <a href="https://help.tcgplayer.com/hc/en-us/articles/360054178934-Store-Your-Products-SYP-Pull-Sheet">SYP Pull Sheet</a>
                                    {{if .ChartID}}</center>{{end}}
                                </h4>
                            {{end}}
                        </td>
                    </tr>
                </table>
            </div>
        </div>

            <div class="indent sticky">
                {{$firstImg := ""}}
                {{$firstPrint := ""}}
                {{$firstProduct := ""}}

                {{if .ChartID}}
                    <div style="margin-left: 10px; float: left; background-color: var(--background);">
                        <canvas id="cardChart" width="760" height="480"></canvas>
                        <br>
                        <hr>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <p style="margin: 0;">
                                {{if $.CanDeleteChart}}
                                    <form action="/{{if .IsSealed}}sealed{{else}}search{{end}}" id=deletechart method="get" style="width: 800px; display: none;">
                                        <select name="dataset" id="dataset" style="width: 110px">
                                            <option selected disabled hidden>&nbsp;&nbsp;&nbsp;Pick dataset</option>
                                            {{range .Datasets}}
                                                <option value="{{.Name}}">&nbsp;&nbsp;&nbsp;{{.Name}}</option>
                                            {{end}}
                                        </select>
                                        <select name="datekey" id="datekey" style="width: 105px">
                                            <option selected disabled hidden>&nbsp;&nbsp;&nbsp;Pick a date</option>
                                            {{range .AxisLabels}}
                                                <option value="{{.}}">&nbsp;&nbsp;&nbsp;{{.}}</option>
                                            {{end}}
                                        </select>
                                        <input id="chart" type="hidden" name="chart" value="{{.ChartID}}"/>
                                        <a class="btn danger" style="text-align: center;" onclick='this.parentNode.submit(); return false;'>Delete</a>
                                    </form>
                                {{end}}
                            </p>
                            <p style="margin: 0;">
                                {{if $.CanDeleteChart}}
                                    <a class="btn warning" onclick="document.getElementById('deletechart').style='inline'">Show delete options</a>
                                {{end}}
                                <a class="btn normal" href="javascript:toggleGaps()">Toggle gaps</a>
                                <a class="btn success" href="javascript:downloadAsImg()">Download</a>
                            </p>
                        </div>
                    </div>
                    <script>
                        var productKeyrunes = {
                            {{range $key := .EditionSort}}
                                {{$editionList := index $.EditionList $key }}
                                    {{range $editionList}}
                                        {{if sixMonthsAgo .Date}}
                                            {{continue}}
                                        {{end}}
                                        "{{.FmtDate}}": "{{.Keyrune}}",
                                    {{end}}
                            {{end}}
                        }

                        // Set a per-chart-style key
                        var legendStorageKey = 'BANChart{{if $.IsSealed}}Sealed{{end}}';

                        // Prepare options
                        var opts = getChartOpts({{.AxisLabels}}, localStorage.getItem("chartSpanGaps"));
                        
                        // Override legend click function
                        opts = withLegendPersistence(legendStorageKey, opts);

                        // Create the chart
                        var ctx = document.getElementById('cardChart').getContext('2d');
                        var cardChart = new Chart(ctx, {
                            type: 'banWithLine',
                            data: {
                                labels: {{.AxisLabels}},
                                datasets: [
                                    {{range .Datasets}}
                                        {
                                            label: {{.Name}},
                                            data: {{.Data}},
                                            backgroundColor: {{.Color}},
                                            borderColor: {{.Color}},
                                            fill: false,
                                            pointRadius: 0,
                                        },
                                    {{end}}
                                ]
                            },
                            options: opts,
                            plugins: [{
                                afterDraw: chart => {
                                    var ctx = chart.chart.ctx;

                                    ctx.textAlign = 'center';
                                    ctx.textBaseline = 'bottom';
                                    ctx.font = '32px Keyrune';
                                    ctx.fillStyle = readVar('--chartjs-text');

                                    var xBottomAxis = chart.scales['x-time'];
                                    var xTopAxis = chart.scales['x-top'];
                                    xTopAxis.ticks.forEach((value, index) => {
                                        if (value in productKeyrunes) {
                                            const padding = 32;

                                            var x = xTopAxis.getPixelForTick(index);
                                            if (x + padding/2 > chart.width) {
                                                x = chart.width - padding / 2;
                                            }

                                            let el = document.createElement('i');
                                            el.className = 'ss-' + productKeyrunes[value];

                                            document.body.appendChild(el);
                                            let content = window.getComputedStyle(el, '::before').content;
                                            content = content.replace(/^"(.*)"$/, '$1');
                                            document.body.removeChild(el);

                                            ctx.fillText(content, x, xTopAxis.top + 24);
                                        }
                                    });
                                }
                            }],
                        });

                        // Load state from local storage
                        applySavedLegendState(cardChart);

                        // Apply theme (light/dark)
                        rethemeFirstAxes(cardChart);

                        // Re-run on theme flips (class changes on <body>/<html>)
                        const rerun = () => cardChart && rethemeFirstAxes(cardChart);
                        const mo = new MutationObserver(rerun);
                        if (document.body) {
                            mo.observe(document.body, {
                                attributes: true,
                                attributeFilter: ['class'],
                            });
                        }
                        mo.observe(document.documentElement, {
                            attributes: true,
                            attributeFilter: ['class'],
                        });

                        function toggleGaps() {
                            cardChart.options.spanGaps = !cardChart.options.spanGaps;
                            cardChart.update();
                            localStorage.setItem("chartSpanGaps", cardChart.options.spanGaps);
                        }
                        function downloadAsImg() {
                            var chartImg = document.createElement('a');
                            {{$card := (index $.Metadata .ChartID)}}
                            chartImg.download = '{{$card.Name}}{{if not $card.Sealed}} [{{$card.SetCode}}] ({{$card.Number}}) {{if $card.Foil}}foil{{else}}{{if $card.Etched}}etched{{else}}nonfoil{{end}}{{end}}{{end}}.png';

                            var scaleFactor = 2;
                            var border = 10;

                            var exportCanvas = document.createElement('canvas');
                            exportCanvas.width = cardChart.width * scaleFactor;
                            exportCanvas.height = cardChart.height * scaleFactor;

                            var exportCtx = exportCanvas.getContext('2d');
                            exportCtx.fillStyle = readVar('--background');
                            exportCtx.fillRect(0, 0, exportCanvas.width, exportCanvas.height);
                            exportCtx.drawImage(cardChart.canvas, border, border, exportCanvas.width - border * 3, exportCanvas.height - border * 2);

                            chartImg.href = exportCanvas.toDataURL("image/png");
                            chartImg.click();
                        }
                    </script>
                {{end}}

                <table style="background-color: var(--background); float:left;" {{if .IsSealed}}onmouseout="document.getElementById('hoverImage').src='{{$emptyImg}}';"{{end}}>
                    {{if .AllKeys}}
                        <tr>
                            <th class="stickyCategory" style="z-index: {{len .AllKeys}}"><h2 align=center>Sellers</h2></th>
                            <th class="stickyCategory" style="z-index: {{len .AllKeys}}"><h2 align=center>Buyers</h2></th>
                            <th class="stickyCategory" style="z-index: {{len .AllKeys}}"><h2 align=center style="display:none" id="lastsalesth">Last Sales</h2></th>
                        </tr>
                    {{end}}

                    <svg height="0" width="0" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="gradient-foil" x1="0%" y1="0%" x2="100%" y2="0%" gradientTransform="rotate(45)">
                                <stop offset="4%"   stop-color="#ea8d66" />
                                <stop offset="18%"  stop-color="#fdef8a" />
                                <stop offset="42%"  stop-color="#8bcc93" />
                                <stop offset="63%"  stop-color="#a6dced" />
                                <stop offset="100%" stop-color="#e599c2" />
                            </linearGradient>
                        </defs>
                    </svg>

                    {{range $i, $cardId := .AllKeys}}
                        {{$card := (index $.Metadata $cardId)}}
                        {{if eq $firstImg ""}}
                            {{$firstImg = $card.ImageURL}}
                            {{$firstPrint = $card.Printings}}
                            {{$firstProduct = $card.Products}}
                        {{end}}

                        <tr onmouseover="updateSidebar({{$card.ImageURL}}, {{$card.Printings}}, {{$card.Products}});" title="[{{$card.SetCode}}] {{$card.Title}}">
                            <th colspan="3" class="wrap stickyHeader" style="text-align: left; vertical-align: middle; z-index: {{inc $i 1}}">
                                <table style="margin:0 0 0 18">
                                    <tr style="background-color:rgba(0, 0, 0, 0);">
                                        <td rowspan=2>
                                            <a href="?q=s:{{$card.SetCode}}">
                                                <span class="small-hidden-text" aria-hidden="true">{{$card.SetCode}}</span>
                                                {{if $card.Keyrune}}
                                                    <i class="ss {{$card.Keyrune}} ss-2x ss-fw"></i>
                                                {{else if $card.RarityColor}}
                                                    <svg width="32" height="32" xmlns="http://www.w3.org/2000/svg" style="margin: 4px 0 0 0">
                                                        <circle r="15" cx="16" cy="16" fill="{{if $card.Foil}}url(#gradient-foil){{else}}{{$card.RarityColor}}{{end}}" stroke="{{if $card.Foil}}black{{else}}{{$card.RarityColor}}{{end}}"/>
                                                        <text font-size="20" x="50%" y="60%" text-anchor="middle" fill="{{if $card.Foil}}black{{else}}var(--background){{end}}">{{$card.SetCode}}</text>
                                                    </svg>
                                                {{else}}
                                                    <h3>{{$card.SetCode}}&nbsp;</h3>
                                                {{end}}
                                            </a>
                                        </td>
                                        <td width=100%>
                                            <a href="{{$card.SearchURL}}" lang="{{$card.LangTag}}">
                                                {{$card.Name}}
                                            </a>
                                            {{if ne $card.Variant ""}}
                                                <i>({{$card.Variant}})</i>
                                            {{end}}
                                            {{if $card.Flag}}
                                                &nbsp;<span class="emoji" style="line-height:0">{{$card.Flag}}</span>
                                            {{end}}
                                            {{if $card.Reserved}}
                                                *
                                            {{end}}
                                            {{if $card.Stocks}}
                                                ‚Ä¢
                                            {{end}}
                                            {{if and $.ShowSYP $card.SypList}}
                                                ‚Ä†
                                            {{end}}
                                        </td>
                                        {{if $card.Sealed}}
                                            {{if $card.Booster}}
                                                <td rowspan=2>
                                                    <a href='/search?q=unpack:"{{$card.Name}}"' title="Simulate opening a booster pack"><span class="emoji">üéÅ</span></a>
                                                </td>
                                            {{end}}
                                            {{if $card.HasDeck}}
                                                <td rowspan=2>
                                                    <a href='/api/tcgplayer/decklist/{{$card.UUID}}' title="Download a TCGplayer-formatted decklist">
                                                        <img width=28 src="/img/misc/decklist.png">
                                                    </a>
                                                </td>
                                                <td rowspan=2>
                                                    <a href='/api/cardmarket/decklist/{{$card.UUID}}' title="Download a Cardmarket-formatted decklist">
                                                        <img width=28 src="/img/misc/decklist-mkm.png">
                                                    </a>
                                                </td>
                                            {{end}}
                                            <td rowspan=2>
                                                <a href='/search?q={{if $card.Booster}}contents{{else}}decklist{{end}}:"{{$card.Name}}"' title="Search what can be found in this product"><span class="emoji">üîé</span></a>
                                            </td>
                                        {{else if $.HasAvailable}}
                                            <td rowspan=2>
                                                <a href='/sealed?q=container:"{{$card.Name}}"' title="Search which products can contain a reprint"><span class="emoji">üìñ</span></a>
                                            </td>
                                        {{end}}
                                        <td rowspan=2>
                                            <span class="emoji" style="cursor: pointer;" onclick="copyAndBlink(this, '{{$card.Name}}')" title="Copy to clipboard">üìù</span>
                                        </td>

                                        {{if not $card.Sealed}}
                                            <td rowspan=2>
                                                <a href="{{$card.DeckboxURL}}" title="Open the Dropbox page for this card" target=_blank><img width=22 src="/img/logo/deckbox.webp"></a>
                                            </td>
                                        {{end}}

                                        {{if $card.CKRestockURL}}
                                            <td rowspan=2>
                                                <a href="{{$card.CKRestockURL}}" title="Set a Restock Notice at CardKingdom" target=_blank>
                                                    <span class="emoji">üè∞</span>
                                                </a>
                                            </td>
                                        {{end}}

                                        {{if $card.ScryfallURL}}
                                            <td rowspan=2>
                                                <a href="{{$card.ScryfallURL}}" title="Check this card on Scryfall.com" target=_blank><img width=28 src="/img/logo/scryfall.svg"></a>
                                            </td>
                                        {{end}}

                                        {{if $card.TCGId}}
                                            <td rowspan=2>
                                                    <a href="https://store.tcgplayer.com/admin/product/manage/{{$card.TCGId}}" title="Manage your TCGplayer inventory" target=_blank><img width=22 src="/img/logo/tcgapp.png"></a>
                                            </td>
                                            <!--
                                            <td rowspan=2>
                                                <a href="javascript:getLastSold('{{$cardId}}')" title="Retrieve last sales on TCG" id="lastsolda{{$cardId}}"><span class="emoji">üí∏</span></a>
                                            </td>
                                            {{$done := false}}
                                            {{$condsEntry := (index $.FoundSellers $cardId)}}
                                            {{range $conditions := $.CondKeys}}
                                                {{$entries := (index $condsEntry $conditions)}}
                                                {{range $entries}}
                                                    {{if and (not $done) (eq .ScraperName "TCGplayer Direct")}}
                                                        <td rowspan=2>
                                                            <span class="emoji" style="cursor: pointer;" onclick="getDirectQty(this,'{{$cardId}}')" title="Update quantities for TCG Direct" id="directqty-{{$cardId}}">‚ö°Ô∏è</span>
                                                        </td>
                                                        {{$done = true}}
                                                    {{end}}
                                                {{end}}
                                            {{end}}
                                            -->
                                        {{end}}
                                        {{if and (not $.DisableChart) (eq $.ChartID "")}}
                                            <td rowspan=2>
                                                <span class="emoji">
                                                    <a href="?chart={{$cardId}}" title="See historical data">üìä</a>
                                                </span>
                                            </td>
                                        {{end}}
                                    </tr>
                                    <tr style="background-color:rgba(0, 0, 0, 0); margin-bottom: 0px;">
                                        <td>
                                            <h6>
                                                <a href="?q=s:{{$card.SetCode}}{{if $card.Date}} date:{{$card.Date}}{{end}}">{{$card.Title}}</a>
                                                {{if $card.SourceSealed}}
                                                    - <a href="/sealed?q=container:{{$card.UUID}}">Found in {{len $card.SourceSealed}} product{{if gt (len $card.SourceSealed) 1}}s{{end}}</a>
                                                {{end}}
                                            </h6>
                                        </td>

                                    </tr>
                                </table>
                            </th>
                        </tr>

                        <tr class="no-hover" style="background-color: var(--background); position: relative; z-index: {{$i}}" onmouseover="updateSidebar({{$card.ImageURL}}, {{$card.Printings}}, {{$card.Products}});">
                            {{$condsEntry := (index $.FoundSellers $cardId)}}
                            <td style="vertical-align: {{if not $condsEntry}}middle{{else}}top{{end}}; padding: 0; margin: 0;">
                                <table class="searchResults" style="margin: 0 6px 0 12px;">
                                    {{if not $condsEntry}}
                                        <tr onmouseover="updateSidebar({{$card.ImageURL}}, {{$card.Printings}}, {{$card.Products}});" style="background-color:rgba(0, 0, 0, 0);">
                                            <td colspan="4">
                                                <center>
                                                    <i>No offers</i>
                                                </center>
                                            </td>
                                        </tr>
                                    {{end}}
                                    {{range $conditions := $.CondKeys}}
                                        {{$entries := (index $condsEntry $conditions)}}
                                        {{if $entries}}
                                            {{if and (eq $conditions "INDEX") $.IsSealed}}
                                                <tr onmocuseover="updateSidebar({{$card.ImageURL}}, {{$card.Printings}});">
                                                    <td></td>
                                                    <th style="min-width: 60px; text-align: center;">EV</td>
                                                    <th style="min-width: 60px; text-align: center;">Sim (Median)</td>
                                                    <th style="min-width: 60px; text-align: center;">Sim (StdDev)</td>
                                                </tr>
                                            {{else if not (eq $conditions "INDEX")}}
                                                <tr onmouseover="updateSidebar({{$card.ImageURL}}, {{$card.Printings}});">
                                                    <td colspan="4" style="padding-top: 8px; padding-bottom: 8px"><i>{{if $.IsSealed}}Purchase from{{else}}Condition: {{$conditions}}{{end}}</i></td>
                                                </tr>
                                            {{end}}
                                        {{end}}
                                        {{range $entries}}
                                            <tr onmouseover="updateSidebar({{$card.ImageURL}}, {{$card.Printings}});">
                                                <td {{if $.IsSealed}}style="min-width: 140px;"{{end}}>
                                                    {{if eq .URL ""}}
                                                        <a class="btn default">
                                                    {{else}}
                                                        <a class="btn normal" href="{{.URL}}" target="_blank" rel="nofollow">
                                                    {{end}}
                                                        {{.ScraperName}}
                                                        {{if ne $conditions "INDEX"}}
                                                            {{.Country}}
                                                        {{end}}
                                                    </a>
                                                </td>
                                                {{if and (eq $conditions "INDEX") $.IsSealed}}
                                                    <td style="text-align: center; vertical-align: middle;">
                                                        $ {{printf "%.2f" .Price}}
                                                    </td>
                                                    <td style="text-align: center; vertical-align: middle;">
                                                        {{if .Secondary}}
                                                            $ {{printf "%.2f" .Secondary}}
                                                            {{$iqr := index .ExtraValues "iqr"}}
                                                            {{if gt $iqr 150.0}}
                                                                <span title="High Simulation IQR: {{printf "%.2f" $iqr}}">‚ÄºÔ∏è</span>
                                                            {{end}}
                                                        {{else}}
                                                            n/a
                                                        {{end}}
                                                    </td>
                                                    <td style="text-align: center; vertical-align: middle;">
                                                        {{if .Secondary}}
                                                            {{$stdDev := index .ExtraValues "stdDev"}}
                                                            {{if $stdDev}}
                                                                $ {{printf "%.2f" $stdDev}}
                                                            {{else}}
                                                                n/a
                                                            {{end}}
                                                        {{else}}
                                                            n/a
                                                        {{end}}
                                                    </td>
                                                {{else}}
                                                    {{if $.IsSealed}}
                                                        <td></td>
                                                    {{end}}
                                                    <td style="text-align: center; vertical-align: middle;" {{if .Credit}}title="Equivalent price if paid with credit: $ {{printf "%.2f" .Credit}}"{{end}}>
                                                        {{if .Price}}
                                                            $ {{printf "%.2f" .Price}}
                                                        {{else}}
                                                            n/a
                                                        {{end}}
                                                        {{if eq .Shorthand "TCGDirect"}}
                                                            {{$marketPrice := tcg_market_price $cardId}}
                                                            {{if gt .Price (mul $marketPrice 2)}}
                                                                <span class=emoji title="CAUTION - This price looks a bit off, TCG Market is {{if $marketPrice}}${{printf "%.2f" $marketPrice}}{{else}}missing{{end}}">‚ÄºÔ∏è </span>
                                                            {{end}}
                                                        {{end}}
                                                    </td>
                                                    {{if .Secondary}}
                                                        <td style="text-align: center; vertical-align: middle;">
                                                            /
                                                        </td>
                                                        <td style="text-align: center; vertical-align: middle;">
                                                            $ {{printf "%.2f" .Secondary}}
                                                        </td>
                                                    {{else}}
                                                        {{if not $.IsSealed}}
                                                            <td></td>
                                                        {{end}}
                                                        <td style="text-align: center; vertical-align: middle;" {{if eq .Shorthand "TCGDirect"}}id="qty-{{.Shorthand}}-{{$conditions}}-{{$cardId}}"{{end}}>
                                                            {{if .BundleIcon}}
                                                                <img style="padding-top:4px;" src="{{.BundleIcon}}">
                                                            {{else if not .NoQuantity}}
                                                                {{.Quantity}}
                                                            {{end}}
                                                        </td>
                                                    {{end}}
                                                {{end}}
                                            </tr>
                                        {{end}}
                                    {{end}}
                                </table>
                            </td>

                            {{$condsEntry := (index $.FoundVendors $cardId)}}
                            <td style="vertical-align: {{if not $condsEntry}}middle{{else}}top{{end}}; padding: 0; margin: 0; position: relative;  z-index: {{$i}}">
                                <table class="searchResults" style="margin: 0 6px 0 12px;">
                                    {{if not $condsEntry}}
                                        <tr onmouseover="updateSidebar({{$card.ImageURL}}, {{$card.Printings}}, {{$card.Products}});" style="background-color:rgba(0, 0, 0, 0);">
                                            <td colspan="4">
                                                <center>
                                                    <i>No offers</i>
                                                </center>
                                            </td>
                                        </tr>
                                    {{end}}
                                    {{range $conditions := $.CondKeys}}
                                        {{$entries := (index $condsEntry $conditions)}}
                                        {{if ne $conditions "INDEX"}}
                                            {{if $entries }}
                                                <tr onmouseover="updateSidebar({{$card.ImageURL}}, {{$card.Printings}}, {{$card.Products}});">
                                                    <td colspan="4" style="padding-top: 8px; padding-bottom: 8px"><i>{{if $.IsSealed}}Sell to{{else}}Condition: {{$conditions}}{{end}}</i></td>
                                                </tr>
                                            {{end}}
                                        {{end}}
                                        {{range $entries}}
                                            <tr onmouseover="updateSidebar({{$card.ImageURL}}, {{$card.Printings}}, {{$card.Products}});">
                                                <td>
                                                    {{if eq .URL ""}}
                                                        <a class="btn default">
                                                    {{else}}
                                                        <a class="btn normal" href="{{.URL}}" target="_blank" rel="nofollow">
                                                    {{end}}
                                                        {{.ScraperName}} {{.Country}}
                                                        {{if eq .Shorthand $card.HotlistStore}}
                                                            <span class=emoji title="Highest price in 3 months">üåü</span>
                                                        {{end}}
                                                    </a>
                                                </td>
                                                <td style="text-align: center; vertical-align: middle;" {{if .Credit}}title="Credit: $ {{printf "%.2f" .Credit}}{{if .MarketCredit}}&#10;&#13;Market: $ {{printf "%.2f" .MarketCredit}}{{end}}"{{end}}>
                                                    {{if ne .Shorthand "SYP"}}
                                                        $ {{printf "%.2f" .Price}}
                                                        {{if eq .Shorthand "TCGDirectNet"}}
                                                            {{$marketPrice := tcg_market_price $cardId}}
                                                            {{if gt .Price (mul $marketPrice 2)}}
                                                                <span class=emoji title="CAUTION - This price looks a bit off, TCG Market is {{if $marketPrice}}${{printf "%.2f" $marketPrice}}{{else}}missing{{end}}">‚ÄºÔ∏è </span>
                                                            {{end}}
                                                        {{end}}
                                                    {{else}}
                                                        # {{.Quantity}}
                                                    {{end}}
                                                </td>
                                                <td style="text-align: center; vertical-align: middle;">
                                                    {{if eq $conditions "NM"}}
                                                        {{if ne .Ratio 0.0}}{{printf "%.2f" .Ratio}} %{{end}}
                                                    {{end}}
                                                </td>
                                                <td style="text-align: center; vertical-align: middle;">
                                                    {{if and .Quantity (eq $conditions "NM")}}
                                                        {{.Quantity}}
                                                    {{end}}
                                                </td>
                                            </tr>
                                        {{end}}
                                    {{end}}
                                </table>
                            </td>

                            <td style="vertical-align: top; padding: 0; margin: 0;">
                                <table class="searchResults" style="margin: 0 12px 0 6px; display:none" id="{{$cardId}}">
                                </table>
                            </td>
                        </tr>
                    {{end}}
                    {{if .CurrentIndex}}
                        <tr style="background-color: var(--headerbackground);">
                            <td colspan="3" style="text-align: center; vertical-align: middle;">
                                <p style="display: inline;">
                                    {{if ne .CurrentIndex 1}}
                                        <a class="pagination" href="?q={{.SearchQuery}}&p=1&sort={{.SearchSort}}&reverse={{.ReverseMode}}">&lt;</a>
                                        <a class="pagination" href="?q={{.SearchQuery}}&p={{.PrevIndex}}&sort={{.SearchSort}}&reverse={{.ReverseMode}}"><i class="arrow left"></i></a>
                                    {{end}}
                                    {{.CurrentIndex}} / {{.TotalIndex}}
                                    {{if ne .CurrentIndex .TotalIndex}}
                                        <a class="pagination" href="?q={{.SearchQuery}}&p={{.NextIndex}}&sort={{.SearchSort}}&reverse={{.ReverseMode}}"><i class="arrow right"></i></a>
                                        <a class="pagination" href="?q={{.SearchQuery}}&p={{.TotalIndex}}&sort={{.SearchSort}}&reverse={{.ReverseMode}}">&gt;</a>
                                    {{end}}
                                </p>
                            </td>
                        </tr>
                    {{end}}
                    {{if ne .InfoMessage ""}}
                        <tr>
                            <td colspan="2" style="text-align: center; vertical-align: middle;">
                                <br>
                                <h4 class="indent"><i>{{.InfoMessage}}</i></h4>
                            </td>
                        </tr>
                    {{end}}
                </table>
                {{if eq $firstImg ""}}
                    {{$firstImg = $.CardBackURL}}
                {{end}}
                {{if .IsSealed}}
                    {{$firstImg = $emptyImg}}
                {{end}}
                <script type="text/javascript">
                    updateSidebar({{$firstImg}}, {{$firstPrint}}, {{$firstProduct}});
                </script>
            </div>
        {{end}}
        <div style="clear:both;"></div>
    {{end}}
    <br>
</div>
</body>
</html>
